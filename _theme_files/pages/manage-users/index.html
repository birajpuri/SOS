<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users - Ambulance Admin</title>
    <script>
        // Authentication check before anything loads
        (function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn !== 'true') {
                window.location.replace('../../login.html');
                throw new Error('Not authenticated'); // Stops further JavaScript execution
            }
        })();
    </script><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/table.css">
</head>

<body>
    <div class="overlay"></div>
    <nav class="sidebar">
        <div class="logo">
            <i class="fas fa-ambulance"></i>
            Ambulance Admin
        </div>
        <a href="../../index.html" class="nav-item">
            <i class="fas fa-home"></i>
            Dashboard
        </a>
        <a href="../booking-history/index.html" class="nav-item ">
            <i class="fas fa-home"></i>
            Booking History
        </a>
        <a href="../manage-users/index.html" class="nav-item active">
            <i class="fas fa-users"></i>
            Manage Users
        </a>
        <a href="../show-on-map/index.html" class="nav-item">
            <i class="fas fa-map-marker-alt"></i>
            Show on Map
        </a>
        <a href="../manage-drivers/index.html" class="nav-item">
            <i class="fas fa-id-card"></i>
            Manage Drivers
        </a>
        <a href="../manage-vehicles/index.html" class="nav-item">
            <i class="fas fa-ambulance"></i>
            Manage Vehicles
        </a>
        <a href="../hospital/index.html" class="nav-item">
            <i class="fas fa-ambulance"></i>
            Hospital
        </a>
        <a href="../emergency-sos/index.html" class="nav-item">
            <i class="fas fa-exclamation-circle"></i>
            Emergency SOS
        </a>
        <a href="../help-and-support/index.html" class="nav-item">
            <i class="fas fa-headset"></i>
            Help & Support
        </a>
        <a href="../settings/index.html" class="nav-item">
            <i class="fas fa-cog"></i>
            Settings
        </a>
        <a href="#" class="nav-item" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
        </a>
    </nav>
    <main class="main-content">
        <div class="header">
            <button class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <h1>Manage Users</h1>
            <input type="search" placeholder="Search..." class="search-bar">
        </div>

        <div class="table-controls">
            <input type="search" placeholder="Search users..." class="search-input">
            <select class="filter-select">
                <option value="">All Users</option>
                <option value="active">Active</option>
                <option value="blocked">Blocked</option>
                <option value="pending">Pending Verification</option>
            </select>
        </div>

        <div class="table-container">
            <div class="table-header">
                <h2>Users List</h2>
                <button class="add-button" onclick="openModal()">
                    <i class="fas fa-plus"></i> Add New User
                </button>
            </div>
            <table class="responsive-table">
                <thead>
                    <tr>
                        <th>User ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Total Bookings</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td data-label="User ID">#USR001</td>
                        <td data-label="Name">John Doe</td>
                        <td data-label="Email">john.doe@email.com</td>
                        <td data-label="Phone">+1 234-567-8900</td>
                        <td data-label="Total Bookings">5</td>
                        <td data-label="Status"><span class="status active">Active</span></td>
                        <td data-label="Actions">
                            <div class="action-buttons">
                                <button class="btn btn-view" onclick="viewUserDetails('#USR001')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-edit" onclick="openModal(true)">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-delete">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- User Form Modal -->
        <div class="modal" id="formModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Add New User</h3>
                    <button class="close-modal" onclick="closeModal()">&times;</button>
                </div>
                <form id="userForm">
                    <div class="form-group">
                        <label class="form-label">User ID</label>
                        <input type="text" class="form-input" placeholder="Auto-generated" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <textarea class="form-input" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" required>
                            <option value="active">Active</option>
                            <option value="blocked">Blocked</option>
                            <option value="pending">Pending Verification</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-save">Save</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- User Details Modal -->
        <div class="modal" id="userDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>User Details</h3>
                    <button class="close-modal" onclick="closeUserDetails()">&times;</button>
                </div>
                <div class="user-details">
                    <div class="detail-group">
                        <label>Booking History</label>
                        <div class="booking-list">
                            <!-- Booking history will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="../../assets/js/user-management.js"></script>
    <script>
        // DOM Elements
        const menuToggle = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        const overlay = document.querySelector('.overlay');
        const navItems = document.querySelectorAll('.nav-item');

        // Toggle sidebar
        function toggleSidebar() {
            sidebar.classList.toggle('expanded');
            overlay.classList.toggle('active');
        }

        // Event Listeners
        menuToggle.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', toggleSidebar);

        // Handle navigation item clicks
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                if (window.innerWidth <= 1024) {
                    toggleSidebar();
                }
            });
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 1024) {
                sidebar.classList.remove('expanded');
                overlay.classList.remove('active');
            }
        });

        function handleLogout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            window.location.href = '../../login.html';
        }
    </script>
</body>
</html>